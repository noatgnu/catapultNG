import{a as Y}from"./chunk-LPVHG6AI.js";import{a as K,b as X}from"./chunk-D5HGWBZ6.js";import{a as Z}from"./chunk-N2XXEWL3.js";import{a as h}from"./chunk-7ITMQ6SW.js";import{$a as O,Aa as U,Da as M,Ea as v,Hb as J,Ka as $,L as k,La as N,M as F,Ma as P,O as b,Oa as r,Pa as x,Q as H,Qa as p,R as W,W as T,Wa as Q,X as L,Xa as D,_a as A,ab as V,da as l,ea as u,la as C,na as R,nb as B,qa as I,qb as G,r as j,sa as y,sb as q,ta as _,ua as S,ub as z,va as a,vb as w,wa as s,xa as d}from"./chunk-VG74EQIO.js";var te=(()=>{let t=class t{constructor(e){this.http=e,this.protocol=window.location.protocol,this.baseURL=h.baseURL.replace("http://","https://"),this.protocol==="http:"?this.baseURL=h.baseURL.replace("https://","http://"):this.baseURL=h.baseURL.replace("http://","https://")}getTasks(e){if(e)return this.http.get(e,{observe:"body",responseType:"json"});let o={ordering:"-id"};return this.http.get(`${this.baseURL}/api/tasks`,{observe:"body",responseType:"json",params:o})}getTask(e){return this.http.get(`${this.baseURL}/api/tasks/${e}/`,{observe:"body",responseType:"json"})}updateTask(e,o){return this.http.patch(`${this.baseURL}/api/tasks/${e}/`,o,{observe:"body",responseType:"json"})}searchTasks(e){return this.http.get(`${this.baseURL}/api/tasks?search=${e}`,{observe:"body",responseType:"json"})}getExperiment(e){return this.http.get(`${this.baseURL}/api/tasks/${e}/get_experiment`,{observe:"body",responseType:"json"})}getAnalysis(e){return this.http.get(`${this.baseURL}/api/tasks/${e}/get_analysis`,{observe:"body",responseType:"json"})}};t.\u0275fac=function(o){return new(o||t)(b(w))},t.\u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var ie=(()=>{let t=class t{constructor(e){this.http=e,this.protocol=window.location.protocol,this.baseURL=h.baseURL.replace("http://","https://"),this.protocol==="http:"?this.baseURL=h.baseURL.replace("https://","http://"):this.baseURL=h.baseURL.replace("http://","https://")}getWorkers(e){return this.http.get(e||this.baseURL+"/api/workers")}};t.\u0275fac=function(o){return new(o||t)(b(w))},t.\u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var ne=(()=>{let t=class t{constructor(e){this.http=e,this.protocol=window.location.protocol,this.baseURL=h.baseURL.replace("http://","https://"),this.protocol==="http:"?this.baseURL=h.baseURL.replace("https://","http://"):this.baseURL=h.baseURL.replace("http://","https://")}getLog(e=0,o="",c=0,f=20){let m=new z;return e!==0&&(m=m.append("worker_id",e.toString())),o!==""&&(m=m.append("search",o)),m=m.append("offset",c.toString()),m=m.append("page_size",f.toString()),m=m.append("ordering","-created_at"),this.http.get(this.baseURL+"/api/logrecords/",{params:m})}};t.\u0275fac=function(o){return new(o||t)(b(w))},t.\u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var pe=["logContainer"],me=n=>({active:n}),de=(n,t,i,e,o)=>({"bg-primary":n,"bg-success":t,"bg-danger":i,"bg-secondary":e,"text-light":o});function he(n,t){if(n&1&&(a(0,"li"),r(1),d(2,"br"),r(3),s()),n&2){let i=t.$implicit;l(),p(" ",i.task_id,""),l(2),p(" ",i.task_name," ")}}function ge(n,t){if(n&1){let i=U();a(0,"div",18),M("click",function(){let o=T(i).$implicit,c=v();return L(c.clickWorkerRow(o.worker_hostname))}),a(1,"b"),r(2),s(),a(3,"div")(4,"p"),r(5),d(6,"br"),r(7),d(8,"br"),s(),a(9,"ul"),_(10,he,4,2,"li",null,y),s()()()}if(n&2){let i=t.$implicit,e=v();R("ngClass",D(4,me,i.worker_hostname===e.selectedWorker)),l(2),x(i.worker_hostname),l(3),p(" OS: ",i.worker_os," "),l(2),p(" Status: ",i.worker_status,""),l(3),S(i.current_tasks)}}function fe(n,t){if(n&1&&(r(0," Working task details for "),a(1,"span",11),r(2),s()),n&2){let i=v();l(2),x(i.selectedWorker)}}function ue(n,t){n&1&&r(0," Select a worker to follow its tasks log output ")}function ve(n,t){if(n&1&&(a(0,"a",14)(1,"div",19)(2,"h5",20),r(3),O(4,"date"),s()(),a(5,"p",20),r(6),s()()),n&2){let i=t.$implicit;l(3),x(V(4,2,i.timestamp,"short")),l(3),x(i.log)}}function xe(n,t){if(n&1&&(a(0,"p")(1,"strong"),r(2,"System:"),s(),r(3),d(4,"br"),a(5,"strong"),r(6,"Release:"),s(),r(7),d(8,"br"),a(9,"strong"),r(10,"Version:"),s(),r(11),d(12,"br"),a(13,"strong"),r(14,"Machine:"),s(),r(15),d(16,"br"),a(17,"strong"),r(18,"Processor:"),s(),r(19),d(20,"br"),a(21,"strong"),r(22,"Logical Cores:"),s(),r(23),d(24,"br"),a(25,"strong"),r(26,"Physical Cores:"),s(),r(27),d(28,"br"),a(29,"strong"),r(30,"Total memory:"),s(),r(31),d(32,"br"),a(33,"strong"),r(34,"CPU Frequency"),s(),r(35),d(36,"br"),s()),n&2){let i=v();l(3),p(" ",i.workerInfo==null?null:i.workerInfo.System," "),l(4),p(" ",i.workerInfo==null?null:i.workerInfo.Release," "),l(4),p(" ",i.workerInfo==null?null:i.workerInfo.Version," "),l(4),p(" ",i.workerInfo==null?null:i.workerInfo.Machine," "),l(4),p(" ",i.workerInfo==null?null:i.workerInfo.Processor," "),l(4),p(" ",i.workerInfo["Total cores"]," "),l(4),p(" ",i.workerInfo["Physical cores"]," "),l(4),p(" ",i.workerInfo["Total Memory"]," "),l(4),p(" ",i.workerInfo["CPU Frequency"]," ")}}function ke(n,t){n&1&&r(0," No worker selected ")}function be(n,t){if(n&1&&(a(0,"div",22)(1,"p")(2,"strong"),r(3,"Analysis"),s(),d(4,"br"),r(5),s(),a(6,"p")(7,"strong"),r(8,"Experiment"),s(),d(9,"br"),r(10),s()()),n&2){let i=v(2);l(5),p(" ",i.analysis.analysis_path," "),l(5),p(" ",i.experiment.experiment_name," ")}}function we(n,t){if(n&1){let i=U();a(0,"div",18),M("click",function(){let o=T(i).$implicit,c=v();return L(c.handleTaskClick(o.id))}),a(1,"div",21)(2,"h5",20),r(3),s()(),a(4,"p",20),r(5),s()(),C(6,be,11,2,"div",22)}if(n&2){let i=t.$implicit,e=v();R("ngClass",A(4,de,i.status==="RUNNING",i.status==="SUCCESS",i.status==="FAILED",i.status==="PENDING",i.status==="SUCCESS"||i.status==="RUNNING"||i.status==="PENDING"||i.status==="FAILED")),l(3),x(i.task_id),l(2),x(i.task_name),l(),I(i.id===e.selectedTask&&e.experiment&&e.analysis?6:-1)}}var re=(()=>{let t=class t{constructor(e,o,c,f,m,oe,se){this.toastService=e,this.websocketService=o,this.experimentService=c,this.analysisService=f,this.taskService=m,this.workerService=oe,this.logService=se,this.n_experiments=0,this.n_analyses=0,this.n_tasks=0,this.baseURL=h.baseURL,this.logMessages=[],this.getData(),this.websocketService.connectAnalysisLog().asObservable().subscribe(g=>{g.timestamp=new Date(g.timestamp*1e3),this.selectedWorker?g.hostname===this.selectedWorker?(this.logMessages.push(g),this.logMessages.length>100&&(this.logMessages=this.logMessages.slice(1)),this.logContainer&&(this.logContainer.nativeElement.scrollTop=this.logContainer.nativeElement.scrollHeight)):g.task_id==="general"&&(this.logMessages.push(g),this.logMessages.length>100&&(this.logMessages=this.logMessages.slice(1)),this.logContainer&&(this.logContainer.nativeElement.scrollTop=this.logContainer.nativeElement.scrollHeight)):(this.logMessages.push(g),this.logMessages.length>100&&(this.logMessages=this.logMessages.slice(1)),this.logContainer&&(this.logContainer.nativeElement.scrollTop=this.logContainer.nativeElement.scrollHeight))}),this.websocketService.connectNotification().asObservable().subscribe(g=>{this.toastService.show(g.task_id,g.status),this.getData()})}ngOnDestroy(){this.websocketService.disconnectAnalysisLog()}getData(){this.experimentService.getExperiments().subscribe(e=>{this.n_experiments=e.count,this.experimentQuery=e}),this.analysisService.getAnalyses().subscribe(e=>{this.n_analyses=e.count,this.analysisQuery=e}),this.taskService.getTasks().subscribe(e=>{this.n_tasks=e.count,this.taskQuery=e}),this.workerService.getWorkers().subscribe(e=>{this.workerQuery=e}),this.logService.getLog().subscribe(e=>{let o=[];for(let c of e.results.reverse())o.push({log:c.log,task_id:"",hostname:"general",timestamp:c.created_at});this.logMessages=o})}clickWorkerRow(e){if(this.selectedWorker===e)this.selectedWorker=void 0,this.workerInfo=void 0;else{this.selectedWorker=e;let o=this.workerQuery?.results.find(c=>c.worker_hostname===e);o&&(this.workerInfo=o.worker_info,this.logService.getLog(o.id).subscribe(c=>{let f=[];for(let m of c.results.reverse())f.push({log:m.log,task_id:"",hostname:o.worker_hostname,timestamp:m.created_at});this.logMessages=f}))}console.log(this.workerInfo),console.log(this.selectedWorker)}handleTaskClick(e){this.selectedTask===e?(this.selectedTask=void 0,this.experiment=void 0,this.analysis=void 0):this.selectedTask=e,j([this.taskService.getAnalysis(e),this.taskService.getExperiment(e)]).subscribe(o=>{this.experiment=o[1],this.analysis=o[0]})}};t.\u0275fac=function(o){return new(o||t)(u(Y),u(Z),u(K),u(X),u(te),u(ie),u(ne))},t.\u0275cmp=H({type:t,selectors:[["app-home"]],viewQuery:function(o,c){if(o&1&&$(pe,5),o&2){let f;N(f=P())&&(c.logContainer=f.first)}},standalone:!0,features:[Q],decls:52,vars:6,consts:[["logContainer",""],[1,"d-flex","flex-row"],[1,"navbar","navbar-expand-lg","navbar-dark","bg-dark","d-flex","flex-wrap","text-light"],[1,"container-fluid"],[1,"navbar-brand"],[1,"home-side-nav-worker-panel"],[1,"list-group","overflow-auto","rounded-0"],["href","#",1,"list-group-item","list-group-item-action",3,"ngClass"],[1,"home-side-nav-server-panel"],[1,"card-text"],[1,"border-end","border-1","border-black","d-flex","flex-column","flex-grow-1"],[1,"text-primary"],[1,"home-main-content-worker-log"],[1,"list-group","overflow-auto"],["href","#",1,"list-group-item","list-group-item-action"],[1,"home-main-content-worker-detail"],[1,"border-end","border-1","border-black","d-flex","flex-column","flex-grow-0"],[1,"home-task-list"],["href","#",1,"list-group-item","list-group-item-action",3,"click","ngClass"],[1,"d-flex","justify-content-between"],[1,"mb-1"],[1,"d-flex","w-100","justify-content-between"],[1,"list-group-item"]],template:function(o,c){o&1&&(a(0,"div",1)(1,"div")(2,"nav",2)(3,"div",3)(4,"div",4),r(5,"Workers"),s()()(),a(6,"div",5)(7,"div",6),_(8,ge,12,6,"div",7,y),s()(),a(10,"nav",2)(11,"div",3)(12,"div",4),r(13,"Backend"),s()()(),a(14,"div",8)(15,"p",9)(16,"strong"),r(17,"Backend:"),s(),r(18),s(),a(19,"p",9),r(20),s(),a(21,"p",9),r(22),s(),a(23,"p",9),r(24),s()()(),a(25,"div",10)(26,"nav",2)(27,"div",3)(28,"div",4),C(29,fe,3,1,"span",11)(30,ue,1,0),s()()(),a(31,"div",12)(32,"div",13,0),_(34,ve,7,5,"a",14,y),s()(),a(36,"nav",2)(37,"div",3)(38,"div",4),r(39," Worker info "),s()()(),a(40,"div",15),C(41,xe,37,9,"p")(42,ke,1,0),s()(),a(43,"div",16)(44,"nav",2)(45,"div",3)(46,"div",4),r(47,"Tasks"),s()()(),a(48,"div",17)(49,"div",6),_(50,we,7,10,null,null,y),s()()()()),o&2&&(l(8),S(c.workerQuery==null?null:c.workerQuery.results),l(10),p(" ",c.baseURL," "),l(2),p(" Experiments: ",c.n_experiments," "),l(2),p(" Analyses: ",c.n_analyses," "),l(2),p(" Tasks: ",c.n_tasks," "),l(5),I(c.selectedWorker?29:30),l(5),S(c.logMessages),l(7),I(c.workerInfo?41:42),l(9),S(c.taskQuery==null?null:c.taskQuery.results))},dependencies:[B,G],styles:[".home-side-nav-worker-panel[_ngcontent-%COMP%]{width:300px;border-right:1px solid #000000;display:flex;flex-direction:column;height:calc(100vh - 354px);overflow:auto}.home-side-nav-server-panel[_ngcontent-%COMP%]{width:300px;display:flex;flex-direction:column;height:183px;overflow:auto;padding:20px}.home-main-content-worker-log[_ngcontent-%COMP%]{height:calc(100vh - 418px);width:calc(100vw - 650px);overflow:auto}.home-main-content-worker-detail[_ngcontent-%COMP%]{height:247px;width:calc(100vw - 650px);overflow:auto;padding:20px}.home-task-list[_ngcontent-%COMP%]{width:300px;height:calc(100vh - 128px);overflow:auto}"]});let n=t;return n})();var ye=[{path:"",component:re,data:{breadcrumbs:["Home"]}}],Ne=(()=>{let t=class t{};t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=W({type:t}),t.\u0275inj=F({imports:[q,J.forChild(ye)]});let n=t;return n})();export{Ne as HomeModule};
